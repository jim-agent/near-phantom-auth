{"version":3,"sources":["../../src/client/api.ts","../../src/client/passkey.ts","../../src/client/hooks/useAnonAuth.tsx","../../src/client/hooks/useOAuth.tsx"],"names":["createContext","useState","useEffect","useCallback","state","jsx","useContext"],"mappings":";;;;;;AA0FO,SAAS,gBAAgB,MAAA,EAAoC;AAClE,EAAA,MAAM,OAAA,GAAU,OAAO,KAAA,IAAS,KAAA;AAChC,EAAA,MAAM,OAAA,GAAU,MAAA,CAAO,OAAA,CAAQ,OAAA,CAAQ,OAAO,EAAE,CAAA;AAEhD,EAAA,eAAe,OAAA,CACb,MAAA,EACA,IAAA,EACA,IAAA,EACY;AACZ,IAAA,MAAM,WAAW,MAAM,OAAA,CAAQ,GAAG,OAAO,CAAA,EAAG,IAAI,CAAA,CAAA,EAAI;AAAA,MAClD,MAAA;AAAA,MACA,OAAA,EAAS;AAAA,QACP,cAAA,EAAgB;AAAA,OAClB;AAAA,MACA,WAAA,EAAa,SAAA;AAAA;AAAA,MACb,IAAA,EAAM,IAAA,GAAO,IAAA,CAAK,SAAA,CAAU,IAAI,CAAA,GAAI;AAAA,KACrC,CAAA;AAED,IAAA,IAAI,CAAC,SAAS,EAAA,EAAI;AAChB,MAAA,MAAM,KAAA,GAAQ,MAAM,QAAA,CAAS,IAAA,EAAK,CAAE,MAAM,OAAO,EAAE,KAAA,EAAO,gBAAA,EAAiB,CAAE,CAAA;AAC7E,MAAA,MAAM,IAAI,KAAA,CAAM,KAAA,CAAM,SAAS,CAAA,gBAAA,EAAmB,QAAA,CAAS,MAAM,CAAA,CAAE,CAAA;AAAA,IACrE;AAEA,IAAA,OAAO,SAAS,IAAA,EAAK;AAAA,EACvB;AAEA,EAAA,OAAO;AAAA;AAAA,IAEL,MAAM,kBAAkB,QAAA,EAAmB;AACzC,MAAA,OAAO,QAAQ,MAAA,EAAQ,iBAAA,EAAmB,WAAW,EAAE,QAAA,KAAa,MAAS,CAAA;AAAA,IAC/E,CAAA;AAAA,IAEA,MAAM,kBAAA,CAAmB,WAAA,EAAa,QAAA,EAAU,UAAA,EAAY,UAAU,QAAA,EAAmB;AACvF,MAAA,OAAO,OAAA,CAAQ,QAAQ,kBAAA,EAAoB;AAAA,QACzC,WAAA;AAAA,QACA,QAAA;AAAA,QACA,UAAA;AAAA,QACA,QAAA;AAAA,QACA;AAAA,OACD,CAAA;AAAA,IACH,CAAA;AAAA;AAAA,IAGA,MAAM,cAAc,QAAA,EAAkB;AACpC,MAAA,OAAO,OAAA,CAAQ,MAAA,EAAQ,iBAAA,EAAmB,EAAE,UAAU,CAAA;AAAA,IACxD,CAAA;AAAA;AAAA,IAGA,MAAM,oBAAoB,QAAA,EAAU;AAClC,MAAA,OAAO,OAAA,CAAQ,MAAA,EAAQ,cAAA,EAAgB,EAAE,UAAU,CAAA;AAAA,IACrD,CAAA;AAAA,IAEA,MAAM,oBAAA,CAAqB,WAAA,EAAa,QAAA,EAAU;AAChD,MAAA,OAAO,OAAA,CAAQ,QAAQ,eAAA,EAAiB;AAAA,QACtC,WAAA;AAAA,QACA;AAAA,OACD,CAAA;AAAA,IACH,CAAA;AAAA;AAAA,IAGA,MAAM,iBAAA,GAAoB;AACxB,MAAA,OAAO,OAAA,CAAQ,OAAO,kBAAkB,CAAA;AAAA,IAC1C,CAAA;AAAA,IAEA,MAAM,WAAW,QAAA,EAAkB;AACjC,MAAA,OAAO,OAAA,CAAQ,MAAA,EAAQ,cAAA,EAAgB,EAAE,UAAU,CAAA;AAAA,IACrD,CAAA;AAAA;AAAA,IAGA,MAAM,cAAc,KAAA,EAAe;AACjC,MAAA,OAAO,OAAA,CAAQ,MAAA,EAAQ,aAAA,EAAe,EAAE,OAAO,CAAA;AAAA,IACjD,CAAA;AAAA,IAEA,MAAM,gBAAgB,KAAA,EAAe;AACnC,MAAA,OAAO,OAAA,CAAQ,MAAA,EAAQ,eAAA,EAAiB,EAAE,OAAO,CAAA;AAAA,IACnD,CAAA;AAAA;AAAA,IAGA,MAAM,UAAA,GAAa;AACjB,MAAA,IAAI;AACF,QAAA,OAAO,MAAM,OAAA,CAAQ,KAAA,EAAO,UAAU,CAAA;AAAA,MACxC,CAAA,CAAA,MAAQ;AACN,QAAA,OAAO,EAAE,eAAe,KAAA,EAAM;AAAA,MAChC;AAAA,IACF,CAAA;AAAA,IAEA,MAAM,MAAA,GAAS;AACb,MAAA,MAAM,OAAA,CAAQ,QAAQ,SAAS,CAAA;AAAA,IACjC,CAAA;AAAA;AAAA,IAGA,MAAM,eAAA,GAAkB;AACtB,MAAA,OAAO,OAAA,CAAQ,QAAQ,uBAAuB,CAAA;AAAA,IAChD,CAAA;AAAA,IAEA,MAAM,gBAAA,CAAiB,SAAA,EAAW,SAAA,EAAW,eAAA,EAAiB;AAC5D,MAAA,OAAO,OAAA,CAAQ,QAAQ,yBAAA,EAA2B;AAAA,QAChD,SAAA;AAAA,QACA,SAAA;AAAA,QACA;AAAA,OACD,CAAA;AAAA,IACH,CAAA;AAAA,IAEA,MAAM,mBAAA,GAAsB;AAC1B,MAAA,OAAO,OAAA,CAAQ,QAAQ,wBAAwB,CAAA;AAAA,IACjD,CAAA;AAAA,IAEA,MAAM,oBAAA,CAAqB,SAAA,EAAW,SAAA,EAAW,aAAA,EAAe;AAC9D,MAAA,OAAO,OAAA,CAAQ,QAAQ,yBAAA,EAA2B;AAAA,QAChD,SAAA;AAAA,QACA,SAAA;AAAA,QACA;AAAA,OACD,CAAA;AAAA,IACH,CAAA;AAAA;AAAA,IAGA,MAAM,kBAAkB,QAAA,EAAU;AAChC,MAAA,OAAO,OAAA,CAAQ,MAAA,EAAQ,sBAAA,EAAwB,EAAE,UAAU,CAAA;AAAA,IAC7D,CAAA;AAAA,IAEA,MAAM,eAAA,CAAgB,GAAA,EAAK,QAAA,EAAU;AACnC,MAAA,OAAO,QAAQ,MAAA,EAAQ,wBAAA,EAA0B,EAAE,GAAA,EAAK,UAAU,CAAA;AAAA,IACpE;AAAA,GACF;AACF;;;ACxMO,SAAS,mBAAA,GAA+B;AAC7C,EAAA,OACE,OAAO,MAAA,KAAW,WAAA,IAClB,OAAO,MAAA,CAAO,wBAAwB,WAAA,IACtC,OAAO,MAAA,CAAO,SAAA,CAAU,WAAA,KAAgB,WAAA;AAE5C;AAKA,eAAsB,gCAAA,GAAqD;AACzE,EAAA,IAAI,CAAC,mBAAA,EAAoB,EAAG,OAAO,KAAA;AAEnC,EAAA,IAAI;AACF,IAAA,OAAO,MAAM,oBAAoB,6CAAA,EAA8C;AAAA,EACjF,CAAA,CAAA,MAAQ;AACN,IAAA,OAAO,KAAA;AAAA,EACT;AACF;AAKA,SAAS,kBAAkB,SAAA,EAAgC;AACzD,EAAA,MAAM,MAAA,GAAS,UAAU,OAAA,CAAQ,IAAA,EAAM,GAAG,CAAA,CAAE,OAAA,CAAQ,MAAM,GAAG,CAAA;AAC7D,EAAA,MAAM,MAAA,GAAA,CAAU,CAAA,GAAK,MAAA,CAAO,MAAA,GAAS,CAAA,IAAM,CAAA;AAC3C,EAAA,MAAM,MAAA,GAAS,MAAA,GAAS,GAAA,CAAI,MAAA,CAAO,MAAM,CAAA;AACzC,EAAA,MAAM,MAAA,GAAS,KAAK,MAAM,CAAA;AAC1B,EAAA,MAAM,KAAA,GAAQ,IAAI,UAAA,CAAW,MAAA,CAAO,MAAM,CAAA;AAC1C,EAAA,KAAA,IAAS,CAAA,GAAI,CAAA,EAAG,CAAA,GAAI,MAAA,CAAO,QAAQ,CAAA,EAAA,EAAK;AACtC,IAAA,KAAA,CAAM,CAAC,CAAA,GAAI,MAAA,CAAO,UAAA,CAAW,CAAC,CAAA;AAAA,EAChC;AACA,EAAA,OAAO,KAAA,CAAM,MAAA;AACf;AAKA,SAAS,kBAAkB,MAAA,EAA6B;AACtD,EAAA,MAAM,KAAA,GAAQ,IAAI,UAAA,CAAW,MAAM,CAAA;AACnC,EAAA,IAAI,MAAA,GAAS,EAAA;AACb,EAAA,KAAA,MAAW,QAAQ,KAAA,EAAO;AACxB,IAAA,MAAA,IAAU,MAAA,CAAO,aAAa,IAAI,CAAA;AAAA,EACpC;AACA,EAAA,MAAM,MAAA,GAAS,KAAK,MAAM,CAAA;AAC1B,EAAA,OAAO,MAAA,CAAO,OAAA,CAAQ,KAAA,EAAO,GAAG,CAAA,CAAE,OAAA,CAAQ,KAAA,EAAO,GAAG,CAAA,CAAE,OAAA,CAAQ,IAAA,EAAM,EAAE,CAAA;AACxE;AAKA,eAAsB,cACpB,OAAA,EACmC;AACnC,EAAA,IAAI,CAAC,qBAAoB,EAAG;AAC1B,IAAA,MAAM,IAAI,MAAM,2CAA2C,CAAA;AAAA,EAC7D;AAGA,EAAA,MAAM,gBAAA,GAAuD;AAAA,IAC3D,SAAA,EAAW,iBAAA,CAAkB,OAAA,CAAQ,SAAS,CAAA;AAAA,IAC9C,IAAI,OAAA,CAAQ,EAAA;AAAA,IACZ,IAAA,EAAM;AAAA,MACJ,EAAA,EAAI,iBAAA,CAAkB,OAAA,CAAQ,IAAA,CAAK,EAAE,CAAA;AAAA,MACrC,IAAA,EAAM,QAAQ,IAAA,CAAK,IAAA;AAAA,MACnB,WAAA,EAAa,QAAQ,IAAA,CAAK;AAAA,KAC5B;AAAA,IACA,kBAAkB,OAAA,CAAQ,gBAAA;AAAA,IAC1B,SAAS,OAAA,CAAQ,OAAA;AAAA,IACjB,wBAAwB,OAAA,CAAQ,sBAAA;AAAA,IAChC,WAAA,EAAa,QAAQ,WAAA,IAAe,MAAA;AAAA,IACpC,kBAAA,EAAoB,OAAA,CAAQ,kBAAA,EAAoB,GAAA,CAAI,CAAC,IAAA,MAAU;AAAA,MAC7D,EAAA,EAAI,iBAAA,CAAkB,IAAA,CAAK,EAAE,CAAA;AAAA,MAC7B,MAAM,IAAA,CAAK,IAAA;AAAA,MACX,YAAY,IAAA,CAAK;AAAA,KACnB,CAAE;AAAA,GACJ;AAGA,EAAA,MAAM,UAAA,GAAa,MAAM,SAAA,CAAU,WAAA,CAAY,MAAA,CAAO;AAAA,IACpD,SAAA,EAAW;AAAA,GACZ,CAAA;AAED,EAAA,IAAI,CAAC,UAAA,EAAY;AACf,IAAA,MAAM,IAAI,MAAM,4BAA4B,CAAA;AAAA,EAC9C;AAEA,EAAA,MAAM,WAAW,UAAA,CAAW,QAAA;AAG5B,EAAA,MAAM,gBAAiB,UAAA,CAA0E,uBAAA;AACjG,EAAA,MAAM,uBAAA,GAA0B,aAAA;AAChC,EAAA,MAAM,UAAA,GAAa,SAAS,aAAA,IAAgB;AAG5C,EAAA,OAAO;AAAA,IACL,IAAI,UAAA,CAAW,EAAA;AAAA,IACf,KAAA,EAAO,iBAAA,CAAkB,UAAA,CAAW,KAAK,CAAA;AAAA,IACzC,IAAA,EAAM,YAAA;AAAA,IACN,QAAA,EAAU;AAAA,MACR,cAAA,EAAgB,iBAAA,CAAkB,QAAA,CAAS,cAAc,CAAA;AAAA,MACzD,iBAAA,EAAmB,iBAAA,CAAkB,QAAA,CAAS,iBAAiB,CAAA;AAAA,MAC/D;AAAA,KACF;AAAA,IACA,sBAAA,EAAwB,WAAW,yBAAA,EAA0B;AAAA;AAAA,IAE7D,uBAAA;AAAA,IACA;AAAA,GACF;AACF;AAMO,SAAS,oBAAoB,UAAA,EAA+C;AACjF,EAAA,MAAM,EAAE,uBAAA,EAAyB,UAAA,EAAW,GAAI,UAAA;AAGhD,EAAA,IAAI,uBAAA,KAA4B,kBAAkB,OAAO,KAAA;AACzD,EAAA,IAAI,UAAA,EAAY,SAAS,KAAK,CAAA,IAAK,YAAY,QAAA,CAAS,KAAK,GAAG,OAAO,KAAA;AAGvE,EAAA,IAAI,uBAAA,KAA4B,YAAY,OAAO,IAAA;AACnD,EAAA,IAAI,UAAA,EAAY,QAAA,CAAS,UAAU,CAAA,EAAG,OAAO,IAAA;AAG7C,EAAA,OAAO,IAAA;AACT;AAKA,eAAsB,wBACpB,OAAA,EACqC;AACrC,EAAA,IAAI,CAAC,qBAAoB,EAAG;AAC1B,IAAA,MAAM,IAAI,MAAM,2CAA2C,CAAA;AAAA,EAC7D;AAGA,EAAA,MAAM,gBAAA,GAAsD;AAAA,IAC1D,SAAA,EAAW,iBAAA,CAAkB,OAAA,CAAQ,SAAS,CAAA;AAAA,IAC9C,SAAS,OAAA,CAAQ,OAAA;AAAA,IACjB,MAAM,OAAA,CAAQ,IAAA;AAAA,IACd,kBAAkB,OAAA,CAAQ,gBAAA;AAAA,IAC1B,gBAAA,EAAkB,OAAA,CAAQ,gBAAA,EAAkB,GAAA,CAAI,CAAC,IAAA,MAAU;AAAA,MACzD,EAAA,EAAI,iBAAA,CAAkB,IAAA,CAAK,EAAE,CAAA;AAAA,MAC7B,MAAM,IAAA,CAAK,IAAA;AAAA,MACX,YAAY,IAAA,CAAK;AAAA,KACnB,CAAE;AAAA,GACJ;AAGA,EAAA,MAAM,UAAA,GAAa,MAAM,SAAA,CAAU,WAAA,CAAY,GAAA,CAAI;AAAA,IACjD,SAAA,EAAW;AAAA,GACZ,CAAA;AAED,EAAA,IAAI,CAAC,UAAA,EAAY;AACf,IAAA,MAAM,IAAI,MAAM,uBAAuB,CAAA;AAAA,EACzC;AAEA,EAAA,MAAM,WAAW,UAAA,CAAW,QAAA;AAG5B,EAAA,OAAO;AAAA,IACL,IAAI,UAAA,CAAW,EAAA;AAAA,IACf,KAAA,EAAO,iBAAA,CAAkB,UAAA,CAAW,KAAK,CAAA;AAAA,IACzC,IAAA,EAAM,YAAA;AAAA,IACN,QAAA,EAAU;AAAA,MACR,cAAA,EAAgB,iBAAA,CAAkB,QAAA,CAAS,cAAc,CAAA;AAAA,MACzD,iBAAA,EAAmB,iBAAA,CAAkB,QAAA,CAAS,iBAAiB,CAAA;AAAA,MAC/D,SAAA,EAAW,iBAAA,CAAkB,QAAA,CAAS,SAAS,CAAA;AAAA,MAC/C,YAAY,QAAA,CAAS,UAAA,GAAa,iBAAA,CAAkB,QAAA,CAAS,UAAU,CAAA,GAAI;AAAA,KAC7E;AAAA,IACA,sBAAA,EAAwB,WAAW,yBAAA;AAA0B,GAC/D;AACF;AC1GA,IAAM,eAAA,GAAkB,cAA2C,IAAI,CAAA;AAShE,SAAS,gBAAA,CAAiB,EAAE,MAAA,EAAQ,QAAA,EAAS,EAA0B;AAC5E,EAAA,MAAM,CAAC,GAAG,CAAA,GAAI,QAAA,CAAS,MAAM,gBAAgB,EAAE,OAAA,EAAS,MAAA,EAAQ,CAAC,CAAA;AACjE,EAAA,MAAM,CAAC,KAAA,EAAO,QAAQ,CAAA,GAAI,QAAA,CAAwB;AAAA,IAChD,SAAA,EAAW,IAAA;AAAA,IACX,eAAA,EAAiB,KAAA;AAAA,IACjB,QAAA,EAAU,IAAA;AAAA,IACV,QAAA,EAAU,IAAA;AAAA,IACV,aAAA,EAAe,IAAA;AAAA,IACf,SAAA,EAAW,IAAA;AAAA,IACX,UAAA,EAAY,IAAA;AAAA,IACZ,KAAA,EAAO,IAAA;AAAA,IACP,iBAAA,EAAmB,KAAA;AAAA,IACnB,qBAAA,EAAuB,KAAA;AAAA,IACvB,KAAA,EAAO,IAAA;AAAA,IACP,qBAAA,EAAuB,IAAA;AAAA,IACvB,gBAAgB;AAAC,GAClB,CAAA;AAGD,EAAA,SAAA,CAAU,MAAM;AACd,IAAA,MAAM,eAAe,YAAY;AAC/B,MAAA,MAAM,oBAAoB,mBAAA,EAAoB;AAC9C,MAAA,MAAM,qBAAA,GAAwB,MAAM,gCAAA,EAAiC;AAErE,MAAA,QAAA,CAAS,CAAC,IAAA,MAAU;AAAA,QAClB,GAAG,IAAA;AAAA,QACH,iBAAA;AAAA,QACA;AAAA,OACF,CAAE,CAAA;AAAA,IACJ,CAAA;AAEA,IAAA,YAAA,EAAa;AAAA,EACf,CAAA,EAAG,EAAE,CAAA;AAGL,EAAA,SAAA,CAAU,MAAM;AACd,IAAA,MAAM,aAAa,YAAY;AAC7B,MAAA,IAAI;AAEF,QAAA,MAAM,OAAA,GAAU,MAAM,GAAA,CAAI,UAAA,EAAW;AAGrC,QAAA,IAAI,iBAA2D,EAAC;AAChE,QAAA,IAAI;AACF,UAAA,MAAM,SAAA,GAAY,MAAM,GAAA,CAAI,iBAAA,EAAkB;AAC9C,UAAA,cAAA,GAAiB,SAAA,CAAU,aAAa,EAAC;AAAA,QAC3C,CAAA,CAAA,MAAQ;AAAA,QAER;AAEA,QAAA,QAAA,CAAS,CAAC,IAAA,MAAU;AAAA,UAClB,GAAG,IAAA;AAAA,UACH,SAAA,EAAW,KAAA;AAAA,UACX,iBAAiB,OAAA,CAAQ,aAAA;AAAA,UACzB,QAAA,EAAU,QAAQ,QAAA,IAAY,IAAA;AAAA,UAC9B,QAAA,EAAU,QAAQ,QAAA,IAAY,IAAA;AAAA,UAC9B,aAAA,EAAe,QAAQ,aAAA,IAAiB,IAAA;AAAA,UACxC,WAAW,OAAA,CAAQ,SAAA,GAAY,IAAI,IAAA,CAAK,OAAA,CAAQ,SAAS,CAAA,GAAI,IAAA;AAAA,UAC7D,UAAA,EAAY,QAAQ,UAAA,IAAc,IAAA;AAAA,UAClC,KAAA,EAAO,QAAQ,KAAA,IAAS,IAAA;AAAA,UACxB;AAAA,SACF,CAAE,CAAA;AAAA,MACJ,SAAS,KAAA,EAAO;AACd,QAAA,QAAA,CAAS,CAAC,IAAA,MAAU;AAAA,UAClB,GAAG,IAAA;AAAA,UACH,SAAA,EAAW,KAAA;AAAA,UACX,KAAA,EAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU;AAAA,SAClD,CAAE,CAAA;AAAA,MACJ;AAAA,IACF,CAAA;AAEA,IAAA,UAAA,EAAW;AAAA,EACb,CAAA,EAAG,CAAC,GAAG,CAAC,CAAA;AAER,EAAA,MAAM,QAAA,GAAW,WAAA,CAAY,OAAO,QAAA,KAAsB;AACxD,IAAA,IAAI;AACF,MAAA,QAAA,CAAS,CAAC,IAAA,MAAU,EAAE,GAAG,IAAA,EAAM,SAAA,EAAW,IAAA,EAAM,KAAA,EAAO,IAAA,EAAM,qBAAA,EAAuB,IAAA,EAAK,CAAE,CAAA;AAG3F,MAAA,MAAM,EAAE,aAAa,OAAA,EAAS,UAAA,EAAY,UAAS,GAAI,MAAM,GAAA,CAAI,iBAAA,CAAkB,QAAQ,CAAA;AAG3F,MAAA,MAAM,UAAA,GAAa,MAAM,aAAA,CAAc,OAAO,CAAA;AAG9C,MAAA,MAAM,WAAA,GAAc,oBAAoB,UAAU,CAAA;AAGlD,MAAA,MAAM,MAAA,GAAS,MAAM,GAAA,CAAI,kBAAA;AAAA,QACvB,WAAA;AAAA,QACA,UAAA;AAAA,QACA,UAAA;AAAA,QACA,QAAA;AAAA,QACA;AAAA,OACF;AAEA,MAAA,IAAI,OAAO,OAAA,EAAS;AAClB,QAAA,QAAA,CAAS,CAAC,IAAA,MAAU;AAAA,UAClB,GAAG,IAAA;AAAA,UACH,SAAA,EAAW,KAAA;AAAA,UACX,eAAA,EAAiB,IAAA;AAAA,UACjB,UAAU,MAAA,CAAO,QAAA;AAAA,UACjB,QAAA,EAAU,MAAA,CAAO,QAAA,IAAY,QAAA,IAAY,IAAA;AAAA,UACzC,eAAe,MAAA,CAAO,aAAA;AAAA,UACtB,UAAA,EAAY,SAAA;AAAA,UACZ,qBAAA,EAAuB;AAAA,SACzB,CAAE,CAAA;AAAA,MACJ,CAAA,MAAO;AACL,QAAA,MAAM,IAAI,MAAM,qBAAqB,CAAA;AAAA,MACvC;AAAA,IACF,SAAS,KAAA,EAAO;AACd,MAAA,QAAA,CAAS,CAAC,IAAA,MAAU;AAAA,QAClB,GAAG,IAAA;AAAA,QACH,SAAA,EAAW,KAAA;AAAA,QACX,KAAA,EAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU;AAAA,OAClD,CAAE,CAAA;AAAA,IACJ;AAAA,EACF,CAAA,EAAG,CAAC,GAAG,CAAC,CAAA;AAER,EAAA,MAAM,KAAA,GAAQ,WAAA,CAAY,OAAO,QAAA,KAAsB;AACrD,IAAA,IAAI;AACF,MAAA,QAAA,CAAS,CAAC,UAAU,EAAE,GAAG,MAAM,SAAA,EAAW,IAAA,EAAM,KAAA,EAAO,IAAA,EAAK,CAAE,CAAA;AAG9D,MAAA,MAAM,EAAE,WAAA,EAAa,OAAA,KAAY,MAAM,GAAA,CAAI,oBAAoB,QAAQ,CAAA;AAGvE,MAAA,MAAM,UAAA,GAAa,MAAM,uBAAA,CAAwB,OAAO,CAAA;AAGxD,MAAA,MAAM,MAAA,GAAS,MAAM,GAAA,CAAI,oBAAA,CAAqB,aAAa,UAAU,CAAA;AAErE,MAAA,IAAI,OAAO,OAAA,EAAS;AAElB,QAAA,MAAM,OAAA,GAAU,MAAM,GAAA,CAAI,UAAA,EAAW;AAErC,QAAA,QAAA,CAAS,CAAC,IAAA,MAAU;AAAA,UAClB,GAAG,IAAA;AAAA,UACH,SAAA,EAAW,KAAA;AAAA,UACX,eAAA,EAAiB,IAAA;AAAA,UACjB,QAAA,EAAU,OAAA,CAAQ,QAAA,IAAY,MAAA,CAAO,QAAA;AAAA,UACrC,aAAA,EAAe,QAAQ,aAAA,IAAiB,IAAA;AAAA,UACxC,WAAW,OAAA,CAAQ,SAAA,GAAY,IAAI,IAAA,CAAK,OAAA,CAAQ,SAAS,CAAA,GAAI;AAAA,SAC/D,CAAE,CAAA;AAAA,MACJ,CAAA,MAAO;AACL,QAAA,MAAM,IAAI,MAAM,uBAAuB,CAAA;AAAA,MACzC;AAAA,IACF,SAAS,KAAA,EAAO;AACd,MAAA,QAAA,CAAS,CAAC,IAAA,MAAU;AAAA,QAClB,GAAG,IAAA;AAAA,QACH,SAAA,EAAW,KAAA;AAAA,QACX,KAAA,EAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU;AAAA,OAClD,CAAE,CAAA;AAAA,IACJ;AAAA,EACF,CAAA,EAAG,CAAC,GAAG,CAAC,CAAA;AAER,EAAA,MAAM,MAAA,GAAS,YAAY,YAAY;AACrC,IAAA,IAAI;AACF,MAAA,MAAM,IAAI,MAAA,EAAO;AAEjB,MAAA,QAAA,CAAS,CAAC,IAAA,MAAU;AAAA,QAClB,GAAG,IAAA;AAAA,QACH,eAAA,EAAiB,KAAA;AAAA,QACjB,QAAA,EAAU,IAAA;AAAA,QACV,aAAA,EAAe,IAAA;AAAA,QACf,SAAA,EAAW;AAAA,OACb,CAAE,CAAA;AAAA,IACJ,SAAS,KAAA,EAAO;AACd,MAAA,QAAA,CAAS,CAAC,IAAA,MAAU;AAAA,QAClB,GAAG,IAAA;AAAA,QACH,KAAA,EAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU;AAAA,OAClD,CAAE,CAAA;AAAA,IACJ;AAAA,EACF,CAAA,EAAG,CAAC,GAAG,CAAC,CAAA;AAER,EAAA,MAAM,cAAA,GAAiB,YAAY,YAAY;AAC7C,IAAA,IAAI;AACF,MAAA,MAAM,OAAA,GAAU,MAAM,GAAA,CAAI,UAAA,EAAW;AAErC,MAAA,QAAA,CAAS,CAAC,IAAA,MAAU;AAAA,QAClB,GAAG,IAAA;AAAA,QACH,iBAAiB,OAAA,CAAQ,aAAA;AAAA,QACzB,QAAA,EAAU,QAAQ,QAAA,IAAY,IAAA;AAAA,QAC9B,aAAA,EAAe,QAAQ,aAAA,IAAiB,IAAA;AAAA,QACxC,WAAW,OAAA,CAAQ,SAAA,GAAY,IAAI,IAAA,CAAK,OAAA,CAAQ,SAAS,CAAA,GAAI;AAAA,OAC/D,CAAE,CAAA;AAAA,IACJ,SAAS,KAAA,EAAO;AACd,MAAA,OAAA,CAAQ,KAAA,CAAM,2BAA2B,KAAK,CAAA;AAAA,IAChD;AAAA,EACF,CAAA,EAAG,CAAC,GAAG,CAAC,CAAA;AAER,EAAA,MAAM,UAAA,GAAa,YAAY,MAAM;AACnC,IAAA,QAAA,CAAS,CAAC,IAAA,MAAU,EAAE,GAAG,IAAA,EAAM,KAAA,EAAO,MAAK,CAAE,CAAA;AAAA,EAC/C,CAAA,EAAG,EAAE,CAAA;AAEL,EAAA,MAAM,aAAA,GAAgB,WAAA,CAAY,OAAO,QAAA,KAAqB;AAC5D,IAAA,IAAI;AACF,MAAA,OAAO,MAAM,GAAA,CAAI,aAAA,CAAc,QAAQ,CAAA;AAAA,IACzC,SAAS,KAAA,EAAO;AACd,MAAA,OAAO,EAAE,SAAA,EAAW,KAAA,EAAO,UAAA,EAAY,MAAA,EAAU;AAAA,IACnD;AAAA,EACF,CAAA,EAAG,CAAC,GAAG,CAAC,CAAA;AAER,EAAA,MAAM,UAAA,GAAa,WAAA,CAAY,OAAO,QAAA,KAAqB;AACzD,IAAA,IAAI;AACF,MAAA,QAAA,CAAS,CAAC,UAAU,EAAE,GAAG,MAAM,SAAA,EAAW,IAAA,EAAM,KAAA,EAAO,IAAA,EAAK,CAAE,CAAA;AAC9D,MAAA,MAAM,EAAE,OAAA,EAAQ,GAAI,MAAM,GAAA,CAAI,WAAW,QAAQ,CAAA;AAEjD,MAAA,MAAA,CAAO,SAAS,IAAA,GAAO,OAAA;AAAA,IACzB,SAAS,KAAA,EAAO;AACd,MAAA,QAAA,CAAS,CAAC,IAAA,MAAU;AAAA,QAClB,GAAG,IAAA;AAAA,QACH,SAAA,EAAW,KAAA;AAAA,QACX,KAAA,EAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU;AAAA,OAClD,CAAE,CAAA;AAAA,IACJ;AAAA,EACF,CAAA,EAAG,CAAC,GAAG,CAAC,CAAA;AAER,EAAA,MAAM,aAAA,GAAgB,WAAA,CAAY,OAAO,KAAA,KAAkB;AACzD,IAAA,IAAI;AACF,MAAA,QAAA,CAAS,CAAC,UAAU,EAAE,GAAG,MAAM,SAAA,EAAW,IAAA,EAAM,KAAA,EAAO,IAAA,EAAK,CAAE,CAAA;AAC9D,MAAA,MAAM,MAAA,GAAS,MAAM,GAAA,CAAI,aAAA,CAAc,KAAK,CAAA;AAC5C,MAAA,QAAA,CAAS,CAAC,IAAA,MAAU;AAAA,QAClB,GAAG,IAAA;AAAA,QACH,SAAA,EAAW,KAAA;AAAA,QACX,KAAA,EAAO,MAAA,CAAO,OAAA,GAAU,IAAA,GAAO;AAAA,OACjC,CAAE,CAAA;AAAA,IACJ,SAAS,KAAA,EAAO;AACd,MAAA,QAAA,CAAS,CAAC,IAAA,MAAU;AAAA,QAClB,GAAG,IAAA;AAAA,QACH,SAAA,EAAW,KAAA;AAAA,QACX,KAAA,EAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU;AAAA,OAClD,CAAE,CAAA;AAAA,IACJ;AAAA,EACF,CAAA,EAAG,CAAC,GAAG,CAAC,CAAA;AAER,EAAA,MAAM,eAAA,GAAkB,WAAA,CAAY,OAAO,KAAA,KAAkB;AAC3D,IAAA,IAAI;AACF,MAAA,QAAA,CAAS,CAAC,UAAU,EAAE,GAAG,MAAM,SAAA,EAAW,IAAA,EAAM,KAAA,EAAO,IAAA,EAAK,CAAE,CAAA;AAC9D,MAAA,MAAM,MAAA,GAAS,MAAM,GAAA,CAAI,eAAA,CAAgB,KAAK,CAAA;AAE9C,MAAA,IAAI,OAAO,OAAA,EAAS;AAClB,QAAA,QAAA,CAAS,CAAC,IAAA,MAAU;AAAA,UAClB,GAAG,IAAA;AAAA,UACH,SAAA,EAAW,KAAA;AAAA,UACX,eAAA,EAAiB,IAAA;AAAA,UACjB,QAAA,EAAU,OAAO,QAAA,IAAY,IAAA;AAAA,UAC7B,aAAA,EAAe,OAAO,aAAA,IAAiB,IAAA;AAAA,UACvC,UAAA,EAAY;AAAA,SACd,CAAE,CAAA;AAAA,MACJ,CAAA,MAAO;AACL,QAAA,MAAM,IAAI,MAAM,+BAA+B,CAAA;AAAA,MACjD;AAAA,IACF,SAAS,KAAA,EAAO;AACd,MAAA,QAAA,CAAS,CAAC,IAAA,MAAU;AAAA,QAClB,GAAG,IAAA;AAAA,QACH,SAAA,EAAW,KAAA;AAAA,QACX,KAAA,EAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU;AAAA,OAClD,CAAE,CAAA;AAAA,IACJ;AAAA,EACF,CAAA,EAAG,CAAC,GAAG,CAAC,CAAA;AAGR,EAAA,MAAM,QAAA,GAA4B;AAAA,IAChC,MAAM,UAAA,CAAW,WAAA,EAAa,eAAA,EAAiB;AAC7C,MAAA,MAAM,EAAE,SAAA,EAAU,GAAI,MAAM,IAAI,eAAA,EAAgB;AAChD,MAAA,MAAM,SAAA,GAAY,MAAM,WAAA,CAAY,SAAS,CAAA;AAC7C,MAAA,MAAM,GAAA,CAAI,gBAAA,CAAiB,SAAA,EAAW,SAAA,EAAW,eAAe,CAAA;AAAA,IAClE,CAAA;AAAA,IAEA,MAAM,iBAAA,CAAkB,WAAA,EAAa,aAAA,EAAe;AAClD,MAAA,MAAM,EAAE,SAAA,EAAU,GAAI,MAAM,IAAI,mBAAA,EAAoB;AACpD,MAAA,MAAM,SAAA,GAAY,MAAM,WAAA,CAAY,SAAS,CAAA;AAC7C,MAAA,MAAM,SAAS,MAAM,GAAA,CAAI,oBAAA,CAAqB,SAAA,EAAW,WAAW,aAAa,CAAA;AAEjF,MAAA,IAAI,OAAO,OAAA,EAAS;AAClB,QAAA,QAAA,CAAS,CAAC,IAAA,MAAU;AAAA,UAClB,GAAG,IAAA;AAAA,UACH,eAAA,EAAiB,IAAA;AAAA,UACjB,UAAU,MAAA,CAAO;AAAA,SACnB,CAAE,CAAA;AAAA,MACJ;AAAA,IACF,CAAA;AAAA,IAEA,MAAM,sBAAsB,QAAA,EAAU;AACpC,MAAA,MAAM,MAAA,GAAS,MAAM,GAAA,CAAI,iBAAA,CAAkB,QAAQ,CAAA;AACnD,MAAA,OAAO,EAAE,GAAA,EAAK,MAAA,CAAO,GAAA,EAAI;AAAA,IAC3B,CAAA;AAAA,IAEA,MAAM,mBAAA,CAAoB,GAAA,EAAK,QAAA,EAAU;AACvC,MAAA,MAAM,MAAA,GAAS,MAAM,GAAA,CAAI,eAAA,CAAgB,KAAK,QAAQ,CAAA;AAEtD,MAAA,IAAI,OAAO,OAAA,EAAS;AAClB,QAAA,QAAA,CAAS,CAAC,IAAA,MAAU;AAAA,UAClB,GAAG,IAAA;AAAA,UACH,eAAA,EAAiB,IAAA;AAAA,UACjB,UAAU,MAAA,CAAO;AAAA,SACnB,CAAE,CAAA;AAAA,MACJ;AAAA,IACF;AAAA,GACF;AAEA,EAAA,MAAM,KAAA,GAA8B;AAAA,IAClC,GAAG,KAAA;AAAA,IACH,QAAA;AAAA,IACA,KAAA;AAAA,IACA,MAAA;AAAA,IACA,cAAA;AAAA,IACA,UAAA;AAAA,IACA,aAAA;AAAA,IACA,UAAA;AAAA,IACA,aAAA;AAAA,IACA,eAAA;AAAA,IACA;AAAA,GACF;AAEA,EAAA,uBACE,GAAA,CAAC,eAAA,CAAgB,QAAA,EAAhB,EAAyB,OACvB,QAAA,EACH,CAAA;AAEJ;AAKO,SAAS,WAAA,GAAoC;AAClD,EAAA,MAAM,OAAA,GAAU,WAAW,eAAe,CAAA;AAE1C,EAAA,IAAI,CAAC,OAAA,EAAS;AACZ,IAAA,MAAM,IAAI,MAAM,kDAAkD,CAAA;AAAA,EACpE;AAEA,EAAA,OAAO,OAAA;AACT;ACtXA,IAAM,YAAA,GAAeA,cAAwC,IAAI,CAAA;AAE1D,SAAS,aAAA,CAAc;AAAA,EAC5B,QAAA;AAAA,EACA,MAAA;AAAA,EACA,cAAA;AAAA,EACA;AACF,CAAA,EAAuB;AACrB,EAAA,MAAM,CAAC,KAAA,EAAO,QAAQ,CAAA,GAAIC,QAAAA,CAAqB;AAAA,IAC7C,SAAA,EAAW,IAAA;AAAA,IACX,KAAA,EAAO,IAAA;AAAA,IACP,WAAW,EAAE,MAAA,EAAQ,OAAO,MAAA,EAAQ,KAAA,EAAO,SAAS,KAAA,EAAM;AAAA,IAC1D,IAAA,EAAM,IAAA;AAAA,IACN,eAAA,EAAiB;AAAA,GAClB,CAAA;AAGD,EAAAC,UAAU,MAAM;AACd,IAAA,eAAe,cAAA,GAAiB;AAC9B,MAAA,IAAI;AACF,QAAA,MAAM,QAAA,GAAW,MAAM,KAAA,CAAM,CAAA,EAAG,MAAM,CAAA,gBAAA,CAAkB,CAAA;AACxD,QAAA,IAAI,SAAS,EAAA,EAAI;AACf,UAAA,MAAM,IAAA,GAAO,MAAM,QAAA,CAAS,IAAA,EAAK;AACjC,UAAA,QAAA,CAAS,CAAA,IAAA,MAAS;AAAA,YAChB,GAAG,IAAA;AAAA,YACH,WAAW,IAAA,CAAK,SAAA;AAAA,YAChB,SAAA,EAAW;AAAA,WACb,CAAE,CAAA;AAAA,QACJ;AAAA,MACF,CAAA,CAAA,MAAQ;AACN,QAAA,QAAA,CAAS,WAAS,EAAE,GAAG,IAAA,EAAM,SAAA,EAAW,OAAM,CAAE,CAAA;AAAA,MAClD;AAAA,IACF;AAEA,IAAA,eAAe,YAAA,GAAe;AAC5B,MAAA,IAAI;AACF,QAAA,MAAM,QAAA,GAAW,MAAM,KAAA,CAAM,CAAA,EAAG,MAAM,CAAA,QAAA,CAAA,EAAY;AAAA,UAChD,WAAA,EAAa;AAAA,SACd,CAAA;AACD,QAAA,IAAI,SAAS,EAAA,EAAI;AACf,UAAA,MAAM,IAAA,GAAO,MAAM,QAAA,CAAS,IAAA,EAAK;AACjC,UAAA,IAAI,IAAA,CAAK,aAAA,IAAiB,IAAA,CAAK,IAAA,KAAS,UAAA,EAAY;AAClD,YAAA,QAAA,CAAS,CAAA,IAAA,MAAS;AAAA,cAChB,GAAG,IAAA;AAAA,cACH,IAAA,EAAM;AAAA,gBACJ,IAAI,IAAA,CAAK,EAAA;AAAA,gBACT,OAAO,IAAA,CAAK,KAAA;AAAA,gBACZ,MAAM,IAAA,CAAK,IAAA;AAAA,gBACX,WAAW,IAAA,CAAK,SAAA;AAAA,gBAChB,eAAe,IAAA,CAAK,aAAA;AAAA,gBACpB,IAAA,EAAM;AAAA,eACR;AAAA,cACA,eAAA,EAAiB;AAAA,aACnB,CAAE,CAAA;AAAA,UACJ;AAAA,QACF;AAAA,MACF,CAAA,CAAA,MAAQ;AAAA,MAER;AAAA,IACF;AAEA,IAAA,cAAA,EAAe;AACf,IAAA,YAAA,EAAa;AAAA,EACf,CAAA,EAAG,CAAC,MAAM,CAAC,CAAA;AAEX,EAAA,MAAM,aAAA,GAAgBC,WAAAA,CAAY,OAAO,QAAA,KAA8C;AACrF,IAAA,QAAA,CAAS,CAAA,IAAA,MAAS,EAAE,GAAG,IAAA,EAAM,WAAW,IAAA,EAAM,KAAA,EAAO,MAAK,CAAE,CAAA;AAE5D,IAAA,IAAI;AACF,MAAA,MAAM,WAAW,MAAM,KAAA,CAAM,GAAG,MAAM,CAAA,OAAA,EAAU,QAAQ,CAAA,MAAA,CAAA,EAAU;AAAA,QAChE,WAAA,EAAa;AAAA,OACd,CAAA;AAED,MAAA,IAAI,CAAC,SAAS,EAAA,EAAI;AAChB,QAAA,MAAM,IAAI,KAAA,CAAM,CAAA,gBAAA,EAAmB,QAAQ,CAAA,MAAA,CAAQ,CAAA;AAAA,MACrD;AAEA,MAAA,MAAM,IAAA,GAAO,MAAM,QAAA,CAAS,IAAA,EAAK;AAGjC,MAAA,cAAA,CAAe,OAAA,CAAQ,aAAA,EAAe,IAAA,CAAK,KAAK,CAAA;AAChD,MAAA,cAAA,CAAe,OAAA,CAAQ,kBAAkB,QAAQ,CAAA;AAGjD,MAAA,MAAA,CAAO,QAAA,CAAS,OAAO,IAAA,CAAK,GAAA;AAAA,IAC9B,SAAS,KAAA,EAAO;AACd,MAAA,MAAM,MAAM,KAAA,YAAiB,KAAA,GAAQ,KAAA,GAAQ,IAAI,MAAM,cAAc,CAAA;AACrE,MAAA,QAAA,CAAS,CAAA,IAAA,MAAS,EAAE,GAAG,IAAA,EAAM,WAAW,KAAA,EAAO,KAAA,EAAO,GAAA,CAAI,OAAA,EAAQ,CAAE,CAAA;AACpE,MAAA,YAAA,GAAe,GAAG,CAAA;AAClB,MAAA,MAAM,GAAA;AAAA,IACR;AAAA,EACF,CAAA,EAAG,CAAC,MAAA,EAAQ,YAAY,CAAC,CAAA;AAEzB,EAAA,MAAM,cAAA,GAAiBA,WAAAA,CAAY,OACjC,QAAA,EACA,MACAC,MAAAA,KACuB;AACvB,IAAA,QAAA,CAAS,CAAA,IAAA,MAAS,EAAE,GAAG,IAAA,EAAM,WAAW,IAAA,EAAM,KAAA,EAAO,MAAK,CAAE,CAAA;AAE5D,IAAA,IAAI;AACF,MAAA,MAAM,WAAW,MAAM,KAAA,CAAM,GAAG,MAAM,CAAA,OAAA,EAAU,QAAQ,CAAA,SAAA,CAAA,EAAa;AAAA,QACnE,MAAA,EAAQ,MAAA;AAAA,QACR,OAAA,EAAS,EAAE,cAAA,EAAgB,kBAAA,EAAmB;AAAA,QAC9C,WAAA,EAAa,SAAA;AAAA,QACb,MAAM,IAAA,CAAK,SAAA,CAAU,EAAE,IAAA,EAAM,KAAA,EAAAA,QAAO;AAAA,OACrC,CAAA;AAED,MAAA,IAAI,CAAC,SAAS,EAAA,EAAI;AAChB,QAAA,MAAM,KAAA,GAAQ,MAAM,QAAA,CAAS,IAAA,EAAK;AAClC,QAAA,MAAM,IAAI,KAAA,CAAM,KAAA,CAAM,KAAA,IAAS,uBAAuB,CAAA;AAAA,MACxD;AAEA,MAAA,MAAM,IAAA,GAAO,MAAM,QAAA,CAAS,IAAA,EAAK;AACjC,MAAA,MAAM,OAAO,IAAA,CAAK,IAAA;AAElB,MAAA,QAAA,CAAS,CAAA,IAAA,MAAS;AAAA,QAChB,GAAG,IAAA;AAAA,QACH,SAAA,EAAW,KAAA;AAAA,QACX,IAAA;AAAA,QACA,eAAA,EAAiB;AAAA,OACnB,CAAE,CAAA;AAEF,MAAA,cAAA,GAAiB,IAAA,EAAM,KAAK,SAAS,CAAA;AAGrC,MAAA,cAAA,CAAe,WAAW,aAAa,CAAA;AACvC,MAAA,cAAA,CAAe,WAAW,gBAAgB,CAAA;AAE1C,MAAA,OAAO,IAAA;AAAA,IACT,SAAS,KAAA,EAAO;AACd,MAAA,MAAM,MAAM,KAAA,YAAiB,KAAA,GAAQ,KAAA,GAAQ,IAAI,MAAM,uBAAuB,CAAA;AAC9E,MAAA,QAAA,CAAS,CAAA,IAAA,MAAS,EAAE,GAAG,IAAA,EAAM,WAAW,KAAA,EAAO,KAAA,EAAO,GAAA,CAAI,OAAA,EAAQ,CAAE,CAAA;AACpE,MAAA,YAAA,GAAe,GAAG,CAAA;AAClB,MAAA,MAAM,GAAA;AAAA,IACR;AAAA,EACF,CAAA,EAAG,CAAC,MAAA,EAAQ,cAAA,EAAgB,YAAY,CAAC,CAAA;AAEzC,EAAA,MAAM,YAAA,GAAeD,WAAAA,CAAY,OAAO,QAAA,KAA8C;AACpF,IAAA,IAAI,CAAC,MAAM,eAAA,EAAiB;AAC1B,MAAA,MAAM,IAAI,MAAM,yCAAyC,CAAA;AAAA,IAC3D;AAGA,IAAA,QAAA,CAAS,WAAS,EAAE,GAAG,IAAA,EAAM,SAAA,EAAW,MAAK,CAAE,CAAA;AAE/C,IAAA,IAAI;AACF,MAAA,MAAM,WAAW,MAAM,KAAA,CAAM,GAAG,MAAM,CAAA,OAAA,EAAU,QAAQ,CAAA,MAAA,CAAA,EAAU;AAAA,QAChE,WAAA,EAAa;AAAA,OACd,CAAA;AAED,MAAA,IAAI,CAAC,SAAS,EAAA,EAAI;AAChB,QAAA,MAAM,IAAI,KAAA,CAAM,CAAA,gBAAA,EAAmB,QAAQ,CAAA,MAAA,CAAQ,CAAA;AAAA,MACrD;AAEA,MAAA,MAAM,IAAA,GAAO,MAAM,QAAA,CAAS,IAAA,EAAK;AAGjC,MAAA,cAAA,CAAe,OAAA,CAAQ,aAAA,EAAe,IAAA,CAAK,KAAK,CAAA;AAChD,MAAA,cAAA,CAAe,OAAA,CAAQ,kBAAkB,QAAQ,CAAA;AACjD,MAAA,cAAA,CAAe,OAAA,CAAQ,gBAAgB,MAAM,CAAA;AAG7C,MAAA,MAAA,CAAO,QAAA,CAAS,OAAO,IAAA,CAAK,GAAA;AAAA,IAC9B,SAAS,KAAA,EAAO;AACd,MAAA,MAAM,MAAM,KAAA,YAAiB,KAAA,GAAQ,KAAA,GAAQ,IAAI,MAAM,aAAa,CAAA;AACpE,MAAA,QAAA,CAAS,CAAA,IAAA,MAAS,EAAE,GAAG,IAAA,EAAM,WAAW,KAAA,EAAO,KAAA,EAAO,GAAA,CAAI,OAAA,EAAQ,CAAE,CAAA;AACpE,MAAA,MAAM,GAAA;AAAA,IACR;AAAA,EACF,CAAA,EAAG,CAAC,MAAA,EAAQ,KAAA,CAAM,eAAe,CAAC,CAAA;AAElC,EAAA,MAAM,cAAA,GAAiBA,YAAY,YAAY;AAC7C,IAAA,IAAI;AACF,MAAA,MAAM,QAAA,GAAW,MAAM,KAAA,CAAM,CAAA,EAAG,MAAM,CAAA,QAAA,CAAA,EAAY;AAAA,QAChD,WAAA,EAAa;AAAA,OACd,CAAA;AAED,MAAA,IAAI,SAAS,EAAA,EAAI;AACf,QAAA,MAAM,IAAA,GAAO,MAAM,QAAA,CAAS,IAAA,EAAK;AACjC,QAAA,IAAI,IAAA,CAAK,aAAA,IAAiB,IAAA,CAAK,IAAA,KAAS,UAAA,EAAY;AAClD,UAAA,QAAA,CAAS,CAAA,IAAA,MAAS;AAAA,YAChB,GAAG,IAAA;AAAA,YACH,IAAA,EAAM;AAAA,cACJ,IAAI,IAAA,CAAK,EAAA;AAAA,cACT,OAAO,IAAA,CAAK,KAAA;AAAA,cACZ,MAAM,IAAA,CAAK,IAAA;AAAA,cACX,WAAW,IAAA,CAAK,SAAA;AAAA,cAChB,eAAe,IAAA,CAAK,aAAA;AAAA,cACpB,IAAA,EAAM;AAAA,aACR;AAAA,YACA,eAAA,EAAiB;AAAA,WACnB,CAAE,CAAA;AAAA,QACJ,CAAA,MAAO;AACL,UAAA,QAAA,CAAS,CAAA,IAAA,MAAS;AAAA,YAChB,GAAG,IAAA;AAAA,YACH,IAAA,EAAM,IAAA;AAAA,YACN,eAAA,EAAiB;AAAA,WACnB,CAAE,CAAA;AAAA,QACJ;AAAA,MACF;AAAA,IACF,CAAA,CAAA,MAAQ;AACN,MAAA,QAAA,CAAS,CAAA,IAAA,MAAS;AAAA,QAChB,GAAG,IAAA;AAAA,QACH,IAAA,EAAM,IAAA;AAAA,QACN,eAAA,EAAiB;AAAA,OACnB,CAAE,CAAA;AAAA,IACJ;AAAA,EACF,CAAA,EAAG,CAAC,MAAM,CAAC,CAAA;AAEX,EAAA,MAAM,MAAA,GAASA,YAAY,YAAY;AACrC,IAAA,IAAI;AACF,MAAA,MAAM,KAAA,CAAM,CAAA,EAAG,MAAM,CAAA,OAAA,CAAA,EAAW;AAAA,QAC9B,MAAA,EAAQ,MAAA;AAAA,QACR,WAAA,EAAa;AAAA,OACd,CAAA;AAAA,IACH,CAAA,SAAE;AACA,MAAA,QAAA,CAAS,CAAA,IAAA,MAAS;AAAA,QAChB,GAAG,IAAA;AAAA,QACH,IAAA,EAAM,IAAA;AAAA,QACN,eAAA,EAAiB;AAAA,OACnB,CAAE,CAAA;AAAA,IACJ;AAAA,EACF,CAAA,EAAG,CAAC,MAAM,CAAC,CAAA;AAEX,EAAA,MAAM,UAAA,GAAaA,YAAY,MAAM;AACnC,IAAA,QAAA,CAAS,WAAS,EAAE,GAAG,IAAA,EAAM,KAAA,EAAO,MAAK,CAAE,CAAA;AAAA,EAC7C,CAAA,EAAG,EAAE,CAAA;AAEL,EAAA,MAAM,KAAA,GAA2B;AAAA,IAC/B,GAAG,KAAA;AAAA,IACH,eAAA,EAAiB,MAAM,aAAA,CAAc,QAAQ,CAAA;AAAA,IAC7C,eAAA,EAAiB,MAAM,aAAA,CAAc,QAAQ,CAAA;AAAA,IAC7C,gBAAA,EAAkB,MAAM,aAAA,CAAc,SAAS,CAAA;AAAA,IAC/C,cAAA;AAAA,IACA,YAAA;AAAA,IACA,UAAA;AAAA,IACA,cAAA;AAAA,IACA;AAAA,GACF;AAEA,EAAA,uBACEE,GAAAA,CAAC,YAAA,CAAa,QAAA,EAAb,EAAsB,OACpB,QAAA,EACH,CAAA;AAEJ;AAEO,SAAS,QAAA,GAA8B;AAC5C,EAAA,MAAM,OAAA,GAAUC,WAAW,YAAY,CAAA;AACvC,EAAA,IAAI,CAAC,OAAA,EAAS;AACZ,IAAA,MAAM,IAAI,MAAM,+CAA+C,CAAA;AAAA,EACjE;AACA,EAAA,OAAO,OAAA;AACT;AAKO,SAAS,gBAAA,GAAmB;AACjC,EAAA,MAAM,QAAQ,QAAA,EAAS;AACvB,EAAA,MAAM,CAAC,YAAA,EAAc,eAAe,CAAA,GAAIL,SAAS,KAAK,CAAA;AACtD,EAAA,MAAM,CAAC,MAAA,EAAQ,SAAS,CAAA,GAAIA,SAAsD,IAAI,CAAA;AAEtF,EAAA,MAAM,eAAA,GAAkBE,YAAY,YAAY;AAE9C,IAAA,MAAM,MAAA,GAAS,IAAI,eAAA,CAAgB,MAAA,CAAO,SAAS,MAAM,CAAA;AACzD,IAAA,MAAM,IAAA,GAAO,MAAA,CAAO,GAAA,CAAI,MAAM,CAAA;AAC9B,IAAA,MAAM,KAAA,GAAQ,MAAA,CAAO,GAAA,CAAI,OAAO,CAAA;AAChC,IAAA,MAAM,KAAA,GAAQ,MAAA,CAAO,GAAA,CAAI,OAAO,CAAA;AAEhC,IAAA,IAAI,KAAA,EAAO;AACT,MAAA,SAAA,CAAU,EAAE,KAAA,EAAO,MAAA,CAAO,IAAI,mBAAmB,CAAA,IAAK,OAAO,CAAA;AAC7D,MAAA;AAAA,IACF;AAEA,IAAA,IAAI,CAAC,IAAA,IAAQ,CAAC,KAAA,EAAO;AACnB,MAAA;AAAA,IACF;AAGA,IAAA,MAAM,WAAA,GAAc,cAAA,CAAe,OAAA,CAAQ,aAAa,CAAA;AACxD,IAAA,MAAM,cAAA,GAAiB,cAAA,CAAe,OAAA,CAAQ,gBAAgB,CAAA;AAE9D,IAAA,IAAI,KAAA,KAAU,WAAA,IAAe,CAAC,cAAA,EAAgB;AAC5C,MAAA,SAAA,CAAU,EAAE,KAAA,EAAO,qBAAA,EAAuB,CAAA;AAC1C,MAAA;AAAA,IACF;AAEA,IAAA,eAAA,CAAgB,IAAI,CAAA;AAEpB,IAAA,IAAI;AACF,MAAA,MAAM,OAAO,MAAM,KAAA,CAAM,cAAA,CAAe,cAAA,EAAgB,MAAM,KAAK,CAAA;AACnE,MAAA,SAAA,CAAU,EAAE,MAAM,CAAA;AAGlB,MAAA,MAAM,GAAA,GAAM,IAAI,GAAA,CAAI,MAAA,CAAO,SAAS,IAAI,CAAA;AACxC,MAAA,GAAA,CAAI,YAAA,CAAa,OAAO,MAAM,CAAA;AAC9B,MAAA,GAAA,CAAI,YAAA,CAAa,OAAO,OAAO,CAAA;AAC/B,MAAA,MAAA,CAAO,QAAQ,YAAA,CAAa,IAAI,EAAA,EAAI,GAAA,CAAI,UAAU,CAAA;AAAA,IACpD,SAAS,GAAA,EAAK;AACZ,MAAA,SAAA,CAAU,EAAE,KAAA,EAAO,GAAA,YAAe,QAAQ,GAAA,CAAI,OAAA,GAAU,gBAAgB,CAAA;AAAA,IAC1E,CAAA,SAAE;AACA,MAAA,eAAA,CAAgB,KAAK,CAAA;AAAA,IACvB;AAAA,EACF,CAAA,EAAG,CAAC,KAAK,CAAC,CAAA;AAEV,EAAA,OAAO;AAAA,IACL,eAAA;AAAA,IACA,YAAA;AAAA,IACA;AAAA,GACF;AACF","file":"index.js","sourcesContent":["/**\n * API Client for near-anon-auth server\n */\n\nimport type {\n  RegistrationStartResponse,\n  RegistrationFinishResponse,\n  AuthenticationStartResponse,\n  AuthenticationFinishResponse,\n  RegistrationResponseJSON,\n  AuthenticationResponseJSON,\n} from '../types/index.js';\n\nexport interface ApiClientConfig {\n  /** Base URL for auth API (e.g., '/auth' or 'https://api.example.com/auth') */\n  baseUrl: string;\n  /** Custom fetch function (optional) */\n  fetch?: typeof fetch;\n}\n\nexport interface SessionInfo {\n  authenticated: boolean;\n  codename?: string;\n  username?: string;\n  nearAccountId?: string;\n  expiresAt?: string;\n  authMethod?: 'passkey' | 'oauth' | 'email';\n  email?: string;\n}\n\nexport interface OAuthProvider {\n  name: string;\n  authUrl: string;\n}\n\nexport interface ApiClient {\n  // Registration with optional username\n  startRegistration(username?: string): Promise<RegistrationStartResponse & { codename: string; tempUserId: string; username?: string }>;\n  finishRegistration(\n    challengeId: string,\n    response: RegistrationResponseJSON,\n    tempUserId: string,\n    codename: string,\n    username?: string\n  ): Promise<RegistrationFinishResponse & { username?: string }>;\n  \n  // Check username availability\n  checkUsername(username: string): Promise<{ available: boolean; suggestion?: string }>;\n  \n  // Authentication\n  startAuthentication(codename?: string): Promise<AuthenticationStartResponse>;\n  finishAuthentication(\n    challengeId: string,\n    response: AuthenticationResponseJSON\n  ): Promise<AuthenticationFinishResponse>;\n  \n  // OAuth\n  getOAuthProviders(): Promise<{ providers: OAuthProvider[] }>;\n  startOAuth(provider: string): Promise<{ authUrl: string }>;\n  \n  // Email Magic Link\n  sendMagicLink(email: string): Promise<{ success: boolean; message: string }>;\n  verifyMagicLink(token: string): Promise<{ success: boolean; codename?: string; nearAccountId?: string }>;\n  \n  // Session\n  getSession(): Promise<SessionInfo>;\n  logout(): Promise<void>;\n  \n  // Wallet Recovery\n  startWalletLink(): Promise<{ challenge: string; expiresAt: string }>;\n  finishWalletLink(\n    signature: unknown,\n    challenge: string,\n    walletAccountId: string\n  ): Promise<{ success: boolean; message: string }>;\n  startWalletRecovery(): Promise<{ challenge: string; expiresAt: string }>;\n  finishWalletRecovery(\n    signature: unknown,\n    challenge: string,\n    nearAccountId: string\n  ): Promise<{ success: boolean; codename: string; message: string }>;\n  \n  // IPFS Recovery\n  setupIPFSRecovery(password: string): Promise<{ success: boolean; cid: string; message: string }>;\n  recoverFromIPFS(cid: string, password: string): Promise<{ success: boolean; codename: string; message: string }>;\n}\n\n/**\n * Create API client\n */\nexport function createApiClient(config: ApiClientConfig): ApiClient {\n  const fetchFn = config.fetch || fetch;\n  const baseUrl = config.baseUrl.replace(/\\/$/, ''); // Remove trailing slash\n\n  async function request<T>(\n    method: string,\n    path: string,\n    body?: unknown\n  ): Promise<T> {\n    const response = await fetchFn(`${baseUrl}${path}`, {\n      method,\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      credentials: 'include', // Include cookies\n      body: body ? JSON.stringify(body) : undefined,\n    });\n\n    if (!response.ok) {\n      const error = await response.json().catch(() => ({ error: 'Request failed' }));\n      throw new Error(error.error || `Request failed: ${response.status}`);\n    }\n\n    return response.json();\n  }\n\n  return {\n    // Registration with optional username\n    async startRegistration(username?: string) {\n      return request('POST', '/register/start', username ? { username } : undefined);\n    },\n\n    async finishRegistration(challengeId, response, tempUserId, codename, username?: string) {\n      return request('POST', '/register/finish', {\n        challengeId,\n        response,\n        tempUserId,\n        codename,\n        username,\n      });\n    },\n\n    // Check username availability\n    async checkUsername(username: string) {\n      return request('POST', '/username/check', { username });\n    },\n\n    // Authentication\n    async startAuthentication(codename) {\n      return request('POST', '/login/start', { codename });\n    },\n\n    async finishAuthentication(challengeId, response) {\n      return request('POST', '/login/finish', {\n        challengeId,\n        response,\n      });\n    },\n\n    // OAuth\n    async getOAuthProviders() {\n      return request('GET', '/oauth/providers');\n    },\n\n    async startOAuth(provider: string) {\n      return request('POST', '/oauth/start', { provider });\n    },\n\n    // Email Magic Link\n    async sendMagicLink(email: string) {\n      return request('POST', '/email/send', { email });\n    },\n\n    async verifyMagicLink(token: string) {\n      return request('POST', '/email/verify', { token });\n    },\n\n    // Session\n    async getSession() {\n      try {\n        return await request('GET', '/session');\n      } catch {\n        return { authenticated: false };\n      }\n    },\n\n    async logout() {\n      await request('POST', '/logout');\n    },\n\n    // Wallet Recovery\n    async startWalletLink() {\n      return request('POST', '/recovery/wallet/link');\n    },\n\n    async finishWalletLink(signature, challenge, walletAccountId) {\n      return request('POST', '/recovery/wallet/verify', {\n        signature,\n        challenge,\n        walletAccountId,\n      });\n    },\n\n    async startWalletRecovery() {\n      return request('POST', '/recovery/wallet/start');\n    },\n\n    async finishWalletRecovery(signature, challenge, nearAccountId) {\n      return request('POST', '/recovery/wallet/finish', {\n        signature,\n        challenge,\n        nearAccountId,\n      });\n    },\n\n    // IPFS Recovery\n    async setupIPFSRecovery(password) {\n      return request('POST', '/recovery/ipfs/setup', { password });\n    },\n\n    async recoverFromIPFS(cid, password) {\n      return request('POST', '/recovery/ipfs/recover', { cid, password });\n    },\n  };\n}\n","/**\n * Client-side Passkey (WebAuthn) operations\n */\n\nimport type {\n  PublicKeyCredentialCreationOptionsJSON,\n  PublicKeyCredentialRequestOptionsJSON,\n  RegistrationResponseJSON,\n  AuthenticationResponseJSON,\n} from '../types/index.js';\n\n/**\n * Check if WebAuthn is supported\n */\nexport function isWebAuthnSupported(): boolean {\n  return (\n    typeof window !== 'undefined' &&\n    typeof window.PublicKeyCredential !== 'undefined' &&\n    typeof window.navigator.credentials !== 'undefined'\n  );\n}\n\n/**\n * Check if platform authenticator is available\n */\nexport async function isPlatformAuthenticatorAvailable(): Promise<boolean> {\n  if (!isWebAuthnSupported()) return false;\n  \n  try {\n    return await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Decode base64url string to ArrayBuffer\n */\nfunction base64urlToBuffer(base64url: string): ArrayBuffer {\n  const base64 = base64url.replace(/-/g, '+').replace(/_/g, '/');\n  const padLen = (4 - (base64.length % 4)) % 4;\n  const padded = base64 + '='.repeat(padLen);\n  const binary = atob(padded);\n  const bytes = new Uint8Array(binary.length);\n  for (let i = 0; i < binary.length; i++) {\n    bytes[i] = binary.charCodeAt(i);\n  }\n  return bytes.buffer;\n}\n\n/**\n * Encode ArrayBuffer to base64url string\n */\nfunction bufferToBase64url(buffer: ArrayBuffer): string {\n  const bytes = new Uint8Array(buffer);\n  let binary = '';\n  for (const byte of bytes) {\n    binary += String.fromCharCode(byte);\n  }\n  const base64 = btoa(binary);\n  return base64.replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=/g, '');\n}\n\n/**\n * Create a new passkey (registration)\n */\nexport async function createPasskey(\n  options: PublicKeyCredentialCreationOptionsJSON\n): Promise<RegistrationResponseJSON> {\n  if (!isWebAuthnSupported()) {\n    throw new Error('WebAuthn is not supported in this browser');\n  }\n\n  // Convert JSON options to WebAuthn format\n  const publicKeyOptions: PublicKeyCredentialCreationOptions = {\n    challenge: base64urlToBuffer(options.challenge),\n    rp: options.rp,\n    user: {\n      id: base64urlToBuffer(options.user.id),\n      name: options.user.name,\n      displayName: options.user.displayName,\n    },\n    pubKeyCredParams: options.pubKeyCredParams,\n    timeout: options.timeout,\n    authenticatorSelection: options.authenticatorSelection,\n    attestation: options.attestation || 'none',\n    excludeCredentials: options.excludeCredentials?.map((cred) => ({\n      id: base64urlToBuffer(cred.id),\n      type: cred.type,\n      transports: cred.transports,\n    })),\n  };\n\n  // Create credential\n  const credential = await navigator.credentials.create({\n    publicKey: publicKeyOptions,\n  }) as PublicKeyCredential;\n\n  if (!credential) {\n    throw new Error('Credential creation failed');\n  }\n\n  const response = credential.response as AuthenticatorAttestationResponse;\n\n  // Get authenticator attachment (platform = likely synced, cross-platform = hardware key)\n  const rawAttachment = (credential as PublicKeyCredential & { authenticatorAttachment?: string }).authenticatorAttachment;\n  const authenticatorAttachment = rawAttachment as 'platform' | 'cross-platform' | undefined;\n  const transports = response.getTransports?.() as RegistrationResponseJSON['response']['transports'];\n\n  // Convert response to JSON format\n  return {\n    id: credential.id,\n    rawId: bufferToBase64url(credential.rawId),\n    type: 'public-key',\n    response: {\n      clientDataJSON: bufferToBase64url(response.clientDataJSON),\n      attestationObject: bufferToBase64url(response.attestationObject),\n      transports,\n    },\n    clientExtensionResults: credential.getClientExtensionResults() as Record<string, unknown>,\n    // Privacy metadata\n    authenticatorAttachment,\n    transports,\n  };\n}\n\n/**\n * Check if credential appears to use cloud-synced storage\n * Returns true if likely synced (platform authenticator), false if likely safe (hardware key)\n */\nexport function isLikelyCloudSynced(credential: RegistrationResponseJSON): boolean {\n  const { authenticatorAttachment, transports } = credential;\n  \n  // Hardware keys are safe\n  if (authenticatorAttachment === 'cross-platform') return false;\n  if (transports?.includes('usb') || transports?.includes('nfc')) return false;\n  \n  // Platform authenticator with internal transport = likely synced\n  if (authenticatorAttachment === 'platform') return true;\n  if (transports?.includes('internal')) return true;\n  \n  // Default to warning (safer)\n  return true;\n}\n\n/**\n * Authenticate with existing passkey\n */\nexport async function authenticateWithPasskey(\n  options: PublicKeyCredentialRequestOptionsJSON\n): Promise<AuthenticationResponseJSON> {\n  if (!isWebAuthnSupported()) {\n    throw new Error('WebAuthn is not supported in this browser');\n  }\n\n  // Convert JSON options to WebAuthn format\n  const publicKeyOptions: PublicKeyCredentialRequestOptions = {\n    challenge: base64urlToBuffer(options.challenge),\n    timeout: options.timeout,\n    rpId: options.rpId,\n    userVerification: options.userVerification,\n    allowCredentials: options.allowCredentials?.map((cred) => ({\n      id: base64urlToBuffer(cred.id),\n      type: cred.type,\n      transports: cred.transports,\n    })),\n  };\n\n  // Get credential\n  const credential = await navigator.credentials.get({\n    publicKey: publicKeyOptions,\n  }) as PublicKeyCredential;\n\n  if (!credential) {\n    throw new Error('Authentication failed');\n  }\n\n  const response = credential.response as AuthenticatorAssertionResponse;\n\n  // Convert response to JSON format\n  return {\n    id: credential.id,\n    rawId: bufferToBase64url(credential.rawId),\n    type: 'public-key',\n    response: {\n      clientDataJSON: bufferToBase64url(response.clientDataJSON),\n      authenticatorData: bufferToBase64url(response.authenticatorData),\n      signature: bufferToBase64url(response.signature),\n      userHandle: response.userHandle ? bufferToBase64url(response.userHandle) : undefined,\n    },\n    clientExtensionResults: credential.getClientExtensionResults() as Record<string, unknown>,\n  };\n}\n","/**\n * React Hook for Anonymous Authentication\n */\n\nimport {\n  createContext,\n  useContext,\n  useState,\n  useEffect,\n  useCallback,\n  type ReactNode,\n} from 'react';\nimport { createApiClient, type ApiClient, type SessionInfo } from '../api.js';\nimport {\n  createPasskey,\n  authenticateWithPasskey,\n  isWebAuthnSupported,\n  isPlatformAuthenticatorAvailable,\n  isLikelyCloudSynced,\n} from '../passkey.js';\n\nexport interface AnonAuthState {\n  /** Whether initial session check is in progress */\n  isLoading: boolean;\n  /** Whether user is authenticated */\n  isAuthenticated: boolean;\n  /** User's codename (e.g., \"ALPHA-7\") */\n  codename: string | null;\n  /** User's chosen username (if custom username enabled) */\n  username: string | null;\n  /** User's NEAR account ID */\n  nearAccountId: string | null;\n  /** Session expiration time */\n  expiresAt: Date | null;\n  /** Authentication method used */\n  authMethod: 'passkey' | 'oauth' | 'email' | null;\n  /** User's email (if authenticated via OAuth or magic link) */\n  email: string | null;\n  /** Whether WebAuthn is supported */\n  webAuthnSupported: boolean;\n  /** Whether platform authenticator (biometric) is available */\n  platformAuthAvailable: boolean;\n  /** Error from last operation */\n  error: string | null;\n  /** Whether the last registered credential appears cloud-synced (privacy warning) */\n  credentialCloudSynced: boolean | null;\n  /** Available OAuth providers */\n  oauthProviders: Array<{ name: string; authUrl: string }>;\n}\n\nexport interface AnonAuthActions {\n  /** Register a new identity with passkey (optional custom username) */\n  register(username?: string): Promise<void>;\n  /** Sign in with existing passkey */\n  login(codename?: string): Promise<void>;\n  /** Sign out */\n  logout(): Promise<void>;\n  /** Refresh session info */\n  refreshSession(): Promise<void>;\n  /** Clear error */\n  clearError(): void;\n  /** Check if username is available */\n  checkUsername(username: string): Promise<{ available: boolean; suggestion?: string }>;\n  /** Start OAuth flow */\n  startOAuth(provider: string): Promise<void>;\n  /** Send magic link email */\n  sendMagicLink(email: string): Promise<void>;\n  /** Verify magic link token */\n  verifyMagicLink(token: string): Promise<void>;\n}\n\nexport interface RecoveryActions {\n  /** Link a NEAR wallet for recovery */\n  linkWallet(signMessage: (message: string) => Promise<{ signature: string; publicKey: string }>, walletAccountId: string): Promise<void>;\n  /** Recover account using wallet */\n  recoverWithWallet(signMessage: (message: string) => Promise<{ signature: string; publicKey: string }>, nearAccountId: string): Promise<void>;\n  /** Set up IPFS password recovery */\n  setupPasswordRecovery(password: string): Promise<{ cid: string }>;\n  /** Recover using IPFS password */\n  recoverWithPassword(cid: string, password: string): Promise<void>;\n}\n\nexport type AnonAuthContextValue = AnonAuthState & AnonAuthActions & {\n  recovery: RecoveryActions;\n};\n\nconst AnonAuthContext = createContext<AnonAuthContextValue | null>(null);\n\nexport interface AnonAuthProviderProps {\n  /** API URL (e.g., '/auth') */\n  apiUrl: string;\n  /** Children */\n  children: ReactNode;\n}\n\nexport function AnonAuthProvider({ apiUrl, children }: AnonAuthProviderProps) {\n  const [api] = useState(() => createApiClient({ baseUrl: apiUrl }));\n  const [state, setState] = useState<AnonAuthState>({\n    isLoading: true,\n    isAuthenticated: false,\n    codename: null,\n    username: null,\n    nearAccountId: null,\n    expiresAt: null,\n    authMethod: null,\n    email: null,\n    webAuthnSupported: false,\n    platformAuthAvailable: false,\n    error: null,\n    credentialCloudSynced: null,\n    oauthProviders: [],\n  });\n\n  // Check WebAuthn support on mount\n  useEffect(() => {\n    const checkSupport = async () => {\n      const webAuthnSupported = isWebAuthnSupported();\n      const platformAuthAvailable = await isPlatformAuthenticatorAvailable();\n      \n      setState((prev) => ({\n        ...prev,\n        webAuthnSupported,\n        platformAuthAvailable,\n      }));\n    };\n    \n    checkSupport();\n  }, []);\n\n  // Check session and fetch OAuth providers on mount\n  useEffect(() => {\n    const initialize = async () => {\n      try {\n        // Check session\n        const session = await api.getSession();\n        \n        // Fetch OAuth providers (non-blocking)\n        let oauthProviders: Array<{ name: string; authUrl: string }> = [];\n        try {\n          const providers = await api.getOAuthProviders();\n          oauthProviders = providers.providers || [];\n        } catch {\n          // OAuth not configured, ignore\n        }\n        \n        setState((prev) => ({\n          ...prev,\n          isLoading: false,\n          isAuthenticated: session.authenticated,\n          codename: session.codename || null,\n          username: session.username || null,\n          nearAccountId: session.nearAccountId || null,\n          expiresAt: session.expiresAt ? new Date(session.expiresAt) : null,\n          authMethod: session.authMethod || null,\n          email: session.email || null,\n          oauthProviders,\n        }));\n      } catch (error) {\n        setState((prev) => ({\n          ...prev,\n          isLoading: false,\n          error: error instanceof Error ? error.message : 'Session check failed',\n        }));\n      }\n    };\n    \n    initialize();\n  }, [api]);\n\n  const register = useCallback(async (username?: string) => {\n    try {\n      setState((prev) => ({ ...prev, isLoading: true, error: null, credentialCloudSynced: null }));\n      \n      // Start registration with optional username\n      const { challengeId, options, tempUserId, codename } = await api.startRegistration(username);\n      \n      // Create passkey\n      const credential = await createPasskey(options);\n      \n      // Check if credential appears cloud-synced (privacy warning)\n      const cloudSynced = isLikelyCloudSynced(credential);\n      \n      // Finish registration\n      const result = await api.finishRegistration(\n        challengeId,\n        credential,\n        tempUserId,\n        codename,\n        username\n      );\n      \n      if (result.success) {\n        setState((prev) => ({\n          ...prev,\n          isLoading: false,\n          isAuthenticated: true,\n          codename: result.codename,\n          username: result.username || username || null,\n          nearAccountId: result.nearAccountId,\n          authMethod: 'passkey',\n          credentialCloudSynced: cloudSynced,\n        }));\n      } else {\n        throw new Error('Registration failed');\n      }\n    } catch (error) {\n      setState((prev) => ({\n        ...prev,\n        isLoading: false,\n        error: error instanceof Error ? error.message : 'Registration failed',\n      }));\n    }\n  }, [api]);\n\n  const login = useCallback(async (codename?: string) => {\n    try {\n      setState((prev) => ({ ...prev, isLoading: true, error: null }));\n      \n      // Start authentication\n      const { challengeId, options } = await api.startAuthentication(codename);\n      \n      // Authenticate with passkey\n      const credential = await authenticateWithPasskey(options);\n      \n      // Finish authentication\n      const result = await api.finishAuthentication(challengeId, credential);\n      \n      if (result.success) {\n        // Refresh session to get full info\n        const session = await api.getSession();\n        \n        setState((prev) => ({\n          ...prev,\n          isLoading: false,\n          isAuthenticated: true,\n          codename: session.codename || result.codename,\n          nearAccountId: session.nearAccountId || null,\n          expiresAt: session.expiresAt ? new Date(session.expiresAt) : null,\n        }));\n      } else {\n        throw new Error('Authentication failed');\n      }\n    } catch (error) {\n      setState((prev) => ({\n        ...prev,\n        isLoading: false,\n        error: error instanceof Error ? error.message : 'Login failed',\n      }));\n    }\n  }, [api]);\n\n  const logout = useCallback(async () => {\n    try {\n      await api.logout();\n      \n      setState((prev) => ({\n        ...prev,\n        isAuthenticated: false,\n        codename: null,\n        nearAccountId: null,\n        expiresAt: null,\n      }));\n    } catch (error) {\n      setState((prev) => ({\n        ...prev,\n        error: error instanceof Error ? error.message : 'Logout failed',\n      }));\n    }\n  }, [api]);\n\n  const refreshSession = useCallback(async () => {\n    try {\n      const session = await api.getSession();\n      \n      setState((prev) => ({\n        ...prev,\n        isAuthenticated: session.authenticated,\n        codename: session.codename || null,\n        nearAccountId: session.nearAccountId || null,\n        expiresAt: session.expiresAt ? new Date(session.expiresAt) : null,\n      }));\n    } catch (error) {\n      console.error('Session refresh failed:', error);\n    }\n  }, [api]);\n\n  const clearError = useCallback(() => {\n    setState((prev) => ({ ...prev, error: null }));\n  }, []);\n\n  const checkUsername = useCallback(async (username: string) => {\n    try {\n      return await api.checkUsername(username);\n    } catch (error) {\n      return { available: false, suggestion: undefined };\n    }\n  }, [api]);\n\n  const startOAuth = useCallback(async (provider: string) => {\n    try {\n      setState((prev) => ({ ...prev, isLoading: true, error: null }));\n      const { authUrl } = await api.startOAuth(provider);\n      // Redirect to OAuth provider\n      window.location.href = authUrl;\n    } catch (error) {\n      setState((prev) => ({\n        ...prev,\n        isLoading: false,\n        error: error instanceof Error ? error.message : 'OAuth failed',\n      }));\n    }\n  }, [api]);\n\n  const sendMagicLink = useCallback(async (email: string) => {\n    try {\n      setState((prev) => ({ ...prev, isLoading: true, error: null }));\n      const result = await api.sendMagicLink(email);\n      setState((prev) => ({\n        ...prev,\n        isLoading: false,\n        error: result.success ? null : 'Failed to send magic link',\n      }));\n    } catch (error) {\n      setState((prev) => ({\n        ...prev,\n        isLoading: false,\n        error: error instanceof Error ? error.message : 'Failed to send magic link',\n      }));\n    }\n  }, [api]);\n\n  const verifyMagicLink = useCallback(async (token: string) => {\n    try {\n      setState((prev) => ({ ...prev, isLoading: true, error: null }));\n      const result = await api.verifyMagicLink(token);\n      \n      if (result.success) {\n        setState((prev) => ({\n          ...prev,\n          isLoading: false,\n          isAuthenticated: true,\n          codename: result.codename || null,\n          nearAccountId: result.nearAccountId || null,\n          authMethod: 'email',\n        }));\n      } else {\n        throw new Error('Invalid or expired magic link');\n      }\n    } catch (error) {\n      setState((prev) => ({\n        ...prev,\n        isLoading: false,\n        error: error instanceof Error ? error.message : 'Magic link verification failed',\n      }));\n    }\n  }, [api]);\n\n  // Recovery actions\n  const recovery: RecoveryActions = {\n    async linkWallet(signMessage, walletAccountId) {\n      const { challenge } = await api.startWalletLink();\n      const signature = await signMessage(challenge);\n      await api.finishWalletLink(signature, challenge, walletAccountId);\n    },\n\n    async recoverWithWallet(signMessage, nearAccountId) {\n      const { challenge } = await api.startWalletRecovery();\n      const signature = await signMessage(challenge);\n      const result = await api.finishWalletRecovery(signature, challenge, nearAccountId);\n      \n      if (result.success) {\n        setState((prev) => ({\n          ...prev,\n          isAuthenticated: true,\n          codename: result.codename,\n        }));\n      }\n    },\n\n    async setupPasswordRecovery(password) {\n      const result = await api.setupIPFSRecovery(password);\n      return { cid: result.cid };\n    },\n\n    async recoverWithPassword(cid, password) {\n      const result = await api.recoverFromIPFS(cid, password);\n      \n      if (result.success) {\n        setState((prev) => ({\n          ...prev,\n          isAuthenticated: true,\n          codename: result.codename,\n        }));\n      }\n    },\n  };\n\n  const value: AnonAuthContextValue = {\n    ...state,\n    register,\n    login,\n    logout,\n    refreshSession,\n    clearError,\n    checkUsername,\n    startOAuth,\n    sendMagicLink,\n    verifyMagicLink,\n    recovery,\n  };\n\n  return (\n    <AnonAuthContext.Provider value={value}>\n      {children}\n    </AnonAuthContext.Provider>\n  );\n}\n\n/**\n * Hook to access anonymous auth state and actions\n */\nexport function useAnonAuth(): AnonAuthContextValue {\n  const context = useContext(AnonAuthContext);\n  \n  if (!context) {\n    throw new Error('useAnonAuth must be used within AnonAuthProvider');\n  }\n  \n  return context;\n}\n","'use client';\n\nimport { createContext, useContext, useCallback, useState, useEffect, type ReactNode } from 'react';\n\nexport interface OAuthProviders {\n  google: boolean;\n  github: boolean;\n  twitter: boolean;\n}\n\nexport interface OAuthUser {\n  id: string;\n  email: string;\n  name?: string;\n  avatarUrl?: string;\n  nearAccountId: string;\n  type: 'standard';\n}\n\nexport interface OAuthState {\n  isLoading: boolean;\n  error: string | null;\n  providers: OAuthProviders;\n  user: OAuthUser | null;\n  isAuthenticated: boolean;\n}\n\nexport interface OAuthActions {\n  /** Initiate Google OAuth login */\n  loginWithGoogle: () => Promise<void>;\n  /** Initiate GitHub OAuth login */\n  loginWithGithub: () => Promise<void>;\n  /** Initiate Twitter (X) OAuth login */\n  loginWithTwitter: () => Promise<void>;\n  /** Handle OAuth callback */\n  handleCallback: (provider: string, code: string, state: string) => Promise<OAuthUser>;\n  /** Link additional OAuth provider */\n  linkProvider: (provider: 'google' | 'github' | 'twitter') => Promise<void>;\n  /** Clear error */\n  clearError: () => void;\n  /** Refresh session */\n  refreshSession: () => Promise<void>;\n  /** Logout */\n  logout: () => Promise<void>;\n}\n\nexport interface OAuthContextValue extends OAuthState, OAuthActions {}\n\nexport interface OAuthProviderProps {\n  children: ReactNode;\n  apiUrl: string;\n  onLoginSuccess?: (user: OAuthUser, isNewUser: boolean) => void;\n  onLoginError?: (error: Error) => void;\n}\n\nconst OAuthContext = createContext<OAuthContextValue | null>(null);\n\nexport function OAuthProvider({\n  children,\n  apiUrl,\n  onLoginSuccess,\n  onLoginError,\n}: OAuthProviderProps) {\n  const [state, setState] = useState<OAuthState>({\n    isLoading: true,\n    error: null,\n    providers: { google: false, github: false, twitter: false },\n    user: null,\n    isAuthenticated: false,\n  });\n\n  // Fetch available providers on mount\n  useEffect(() => {\n    async function fetchProviders() {\n      try {\n        const response = await fetch(`${apiUrl}/oauth/providers`);\n        if (response.ok) {\n          const data = await response.json();\n          setState(prev => ({\n            ...prev,\n            providers: data.providers,\n            isLoading: false,\n          }));\n        }\n      } catch {\n        setState(prev => ({ ...prev, isLoading: false }));\n      }\n    }\n\n    async function checkSession() {\n      try {\n        const response = await fetch(`${apiUrl}/session`, {\n          credentials: 'include',\n        });\n        if (response.ok) {\n          const data = await response.json();\n          if (data.authenticated && data.type === 'standard') {\n            setState(prev => ({\n              ...prev,\n              user: {\n                id: data.id,\n                email: data.email,\n                name: data.name,\n                avatarUrl: data.avatarUrl,\n                nearAccountId: data.nearAccountId,\n                type: 'standard',\n              },\n              isAuthenticated: true,\n            }));\n          }\n        }\n      } catch {\n        // Session check failed, user not authenticated\n      }\n    }\n\n    fetchProviders();\n    checkSession();\n  }, [apiUrl]);\n\n  const initiateOAuth = useCallback(async (provider: 'google' | 'github' | 'twitter') => {\n    setState(prev => ({ ...prev, isLoading: true, error: null }));\n\n    try {\n      const response = await fetch(`${apiUrl}/oauth/${provider}/start`, {\n        credentials: 'include',\n      });\n\n      if (!response.ok) {\n        throw new Error(`Failed to start ${provider} OAuth`);\n      }\n\n      const data = await response.json();\n      \n      // Store state for verification after redirect\n      sessionStorage.setItem('oauth_state', data.state);\n      sessionStorage.setItem('oauth_provider', provider);\n      \n      // Redirect to provider\n      window.location.href = data.url;\n    } catch (error) {\n      const err = error instanceof Error ? error : new Error('OAuth failed');\n      setState(prev => ({ ...prev, isLoading: false, error: err.message }));\n      onLoginError?.(err);\n      throw err;\n    }\n  }, [apiUrl, onLoginError]);\n\n  const handleCallback = useCallback(async (\n    provider: string,\n    code: string,\n    state: string\n  ): Promise<OAuthUser> => {\n    setState(prev => ({ ...prev, isLoading: true, error: null }));\n\n    try {\n      const response = await fetch(`${apiUrl}/oauth/${provider}/callback`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ code, state }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'OAuth callback failed');\n      }\n\n      const data = await response.json();\n      const user = data.user as OAuthUser;\n\n      setState(prev => ({\n        ...prev,\n        isLoading: false,\n        user,\n        isAuthenticated: true,\n      }));\n\n      onLoginSuccess?.(user, data.isNewUser);\n      \n      // Clean up stored state\n      sessionStorage.removeItem('oauth_state');\n      sessionStorage.removeItem('oauth_provider');\n\n      return user;\n    } catch (error) {\n      const err = error instanceof Error ? error : new Error('OAuth callback failed');\n      setState(prev => ({ ...prev, isLoading: false, error: err.message }));\n      onLoginError?.(err);\n      throw err;\n    }\n  }, [apiUrl, onLoginSuccess, onLoginError]);\n\n  const linkProvider = useCallback(async (provider: 'google' | 'github' | 'twitter') => {\n    if (!state.isAuthenticated) {\n      throw new Error('Must be authenticated to link providers');\n    }\n\n    // Start OAuth flow for linking\n    setState(prev => ({ ...prev, isLoading: true }));\n\n    try {\n      const response = await fetch(`${apiUrl}/oauth/${provider}/start`, {\n        credentials: 'include',\n      });\n\n      if (!response.ok) {\n        throw new Error(`Failed to start ${provider} OAuth`);\n      }\n\n      const data = await response.json();\n      \n      // Store state for verification after redirect\n      sessionStorage.setItem('oauth_state', data.state);\n      sessionStorage.setItem('oauth_provider', provider);\n      sessionStorage.setItem('oauth_action', 'link');\n      \n      // Redirect to provider\n      window.location.href = data.url;\n    } catch (error) {\n      const err = error instanceof Error ? error : new Error('Link failed');\n      setState(prev => ({ ...prev, isLoading: false, error: err.message }));\n      throw err;\n    }\n  }, [apiUrl, state.isAuthenticated]);\n\n  const refreshSession = useCallback(async () => {\n    try {\n      const response = await fetch(`${apiUrl}/session`, {\n        credentials: 'include',\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        if (data.authenticated && data.type === 'standard') {\n          setState(prev => ({\n            ...prev,\n            user: {\n              id: data.id,\n              email: data.email,\n              name: data.name,\n              avatarUrl: data.avatarUrl,\n              nearAccountId: data.nearAccountId,\n              type: 'standard',\n            },\n            isAuthenticated: true,\n          }));\n        } else {\n          setState(prev => ({\n            ...prev,\n            user: null,\n            isAuthenticated: false,\n          }));\n        }\n      }\n    } catch {\n      setState(prev => ({\n        ...prev,\n        user: null,\n        isAuthenticated: false,\n      }));\n    }\n  }, [apiUrl]);\n\n  const logout = useCallback(async () => {\n    try {\n      await fetch(`${apiUrl}/logout`, {\n        method: 'POST',\n        credentials: 'include',\n      });\n    } finally {\n      setState(prev => ({\n        ...prev,\n        user: null,\n        isAuthenticated: false,\n      }));\n    }\n  }, [apiUrl]);\n\n  const clearError = useCallback(() => {\n    setState(prev => ({ ...prev, error: null }));\n  }, []);\n\n  const value: OAuthContextValue = {\n    ...state,\n    loginWithGoogle: () => initiateOAuth('google'),\n    loginWithGithub: () => initiateOAuth('github'),\n    loginWithTwitter: () => initiateOAuth('twitter'),\n    handleCallback,\n    linkProvider,\n    clearError,\n    refreshSession,\n    logout,\n  };\n\n  return (\n    <OAuthContext.Provider value={value}>\n      {children}\n    </OAuthContext.Provider>\n  );\n}\n\nexport function useOAuth(): OAuthContextValue {\n  const context = useContext(OAuthContext);\n  if (!context) {\n    throw new Error('useOAuth must be used within an OAuthProvider');\n  }\n  return context;\n}\n\n/**\n * Hook to handle OAuth callback from URL parameters\n */\nexport function useOAuthCallback() {\n  const oauth = useOAuth();\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [result, setResult] = useState<{ user?: OAuthUser; error?: string } | null>(null);\n\n  const processCallback = useCallback(async () => {\n    // Check if we have OAuth params in URL\n    const params = new URLSearchParams(window.location.search);\n    const code = params.get('code');\n    const state = params.get('state');\n    const error = params.get('error');\n\n    if (error) {\n      setResult({ error: params.get('error_description') || error });\n      return;\n    }\n\n    if (!code || !state) {\n      return;\n    }\n\n    // Verify state matches\n    const storedState = sessionStorage.getItem('oauth_state');\n    const storedProvider = sessionStorage.getItem('oauth_provider');\n\n    if (state !== storedState || !storedProvider) {\n      setResult({ error: 'Invalid OAuth state' });\n      return;\n    }\n\n    setIsProcessing(true);\n\n    try {\n      const user = await oauth.handleCallback(storedProvider, code, state);\n      setResult({ user });\n      \n      // Clean up URL\n      const url = new URL(window.location.href);\n      url.searchParams.delete('code');\n      url.searchParams.delete('state');\n      window.history.replaceState({}, '', url.toString());\n    } catch (err) {\n      setResult({ error: err instanceof Error ? err.message : 'OAuth failed' });\n    } finally {\n      setIsProcessing(false);\n    }\n  }, [oauth]);\n\n  return {\n    processCallback,\n    isProcessing,\n    result,\n  };\n}\n"]}